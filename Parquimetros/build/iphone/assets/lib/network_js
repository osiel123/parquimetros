function checkInternetConnection(){return Ti.Network.online?!0:(showInternetError(),!1)}function showInternetError(){var e=Ti.UI.createAlertDialog({title:L("connection_error_title"),message:L("connection_error"),buttonNames:[L("cancel"),L("settings")]});e.show(),e.addEventListener("click",function(e){if(1==e.index&&"android"==Ti.Platform.name){var t=Titanium.Android.createIntent({action:"android.settings.SETTINGS"});Ti.Android.currentActivity.startActivity(t)}})}function reportPosition(e){try{!e.success||e.error||(latitude=e.coords.latitude,longitude=e.coords.longitude,Ti.App.Properties.setString("latitude",latitude),Ti.App.Properties.setString("longitude",longitude))}catch(t){Ti.API.info("location error --------------- "+t)}}exports.login=function(e,t){if(checkInternetConnection()){var i='{"user" : {"login" : "'+e.username+'", "password" : "'+e.password+'" }, "commit": "Sign in"}',o=Titanium.Network.createHTTPClient(),r=Ti.App.hostname+"/users/sign_in.json";Ti.API.info("signIn url --------------------- "+r),Ti.API.info("signIn credentials --------------------- "+i),o.open("POST",r),o.setRequestHeader("Content-Type","application/json"),o.send(i),o.setTimeout(7e3),o.onerror=function(e){Ti.API.info("Error signIn ------------ "+JSON.stringify(e)),showMessageError(L("error")+" "+L("try_again")),t(!1)},o.onload=function(){var e;try{e=JSON.parse(this.responseText),Ti.API.info("signIn response ------------------- "+JSON.stringify(e)),t(void 0==e.id?!1:e)}catch(i){Ti.API.info("login ex "+i.toString()),t(!1)}}}else t(!1)},exports.signOut=function(e){var t=Titanium.Network.createHTTPClient(),i=Ti.App.hostname+"/users/sign_out.json";t.open("DELETE",i),t.setRequestHeader("Content-Type","application/json"),t.send(),t.setTimeout(7e3),t.onerror=function(t){Ti.API.info("Error signOut"),e(!0)},t.onload=function(){e(!0)}},exports.getData=function(e){if(checkInternetConnection()){var t=Titanium.Network.createHTTPClient(),i=Ti.App.hostname+"/mobile_services/get_data.json";Ti.API.info("getData url --------------------- "+i),t.open("GET",i),t.setRequestHeader("Content-Type","application/json"),t.send(),t.setTimeout(7e3),t.onerror=function(t){Ti.API.info("Error getData ------------ "+JSON.stringify(t)),showMessageError(L("error")+" "+L("try_again")),e(!1)},t.onload=function(){var t;try{t=JSON.parse(this.responseText),Ti.API.info("getData response ------------------- "+JSON.stringify(t)),void 0!=t.error?(showMessageError(t.error),e(!1)):e(t)}catch(i){Ti.API.info("getData ex "+i.toString()),e(!1)}}}else e(!1)},exports.getPlates=function(e,t){if(checkInternetConnection()){var i=Titanium.Network.createHTTPClient(),o=Ti.App.hostname+"/mobile_services/get_plates.json?plates_serial_number="+e.plates_serial_number;Ti.API.info("getPlates url --------------------- "+o),i.open("GET",o),i.setRequestHeader("Content-Type","application/json"),i.send(),i.setTimeout(7e3),i.onerror=function(e){Ti.API.info("Error getPlates ------------ "+JSON.stringify(e)),showMessageError(L("error")+" "+L("try_again")),t(!1)},i.onload=function(){var e;try{e=JSON.parse(this.responseText),Ti.API.info("getPlates response ------------------- "+JSON.stringify(e)),void 0!=e.error?(showMessageError(e.error),t(!1)):t(e)}catch(i){Ti.API.info("getPlates ex "+i.toString()),t(!1)}}}else t(!1)},exports.getTicketData=function(e,t){if(checkInternetConnection()){var i=Titanium.Network.createHTTPClient(),o=Ti.App.hostname+"/mobile_services/get_ticket.json?ticket_id="+e.ticket_id;Ti.API.info("getPlatesByTicket url --------------------- "+o),i.open("GET",o),i.setRequestHeader("Content-Type","application/json"),i.send(),i.setTimeout(7e3),i.onerror=function(e){Ti.API.info("Error getTicketData ------------ "+JSON.stringify(e)),showMessageError(L("error")+" "+L("try_again")),t(!1)},i.onload=function(){var e;try{e=JSON.parse(this.responseText),Ti.API.info("getTicketData response ------------------- "+JSON.stringify(e)),void 0!=e.error?(showMessageError(e.error),t(!1)):t(e)}catch(i){Ti.API.info("getTicketData ex "+i.toString()),t(!1)}}}else t(!1)},exports.getTickets=function(e,t){if(checkInternetConnection()){var i=Titanium.Network.createHTTPClient(),o=Ti.App.hostname+"/mobile_services/get_tickets.json?plates_serial_number="+e.plates_serial_number;Ti.API.info("getTickets url --------------------- "+o),i.open("GET",o),i.setRequestHeader("Content-Type","application/json"),i.send(),i.setTimeout(7e3),i.onerror=function(e){Ti.API.info("Error getTickets ------------ "+JSON.stringify(e)),t(!1)},i.onload=function(){var e;try{e=JSON.parse(this.responseText),Ti.API.info("getTickets response ------------------- "+JSON.stringify(e)),void 0!=e.error?(showMessageError(e.error),t(!1)):t(e)}catch(i){Ti.API.info("getTickets ex "+i.toString()),t(!1)}}}else t(!1)},exports.createTicket=function(e,t){if(checkInternetConnection()){var i='{"utf8":"✓", "latitude" : "'+Ti.App.Properties.getString("latitude")+'", "longitude" : "'+Ti.App.Properties.getString("longitude")+'", "ticket":{"plate_id":"'+e.plate_id+'", "plate_attributes":{"plates_number":"'+e.plates_number+'", "plate_type_id":"'+e.plate_type_id+'", "year":"'+e.plates_year+'", "city":"'+e.city+'", "state":"'+e.state+'", "owner":"'+e.owner+'", "vehicle_attributes":{"serial_number":"'+e.serial_number+'", "brand":"'+e.brand+'", "model":"'+e.model+'", "series":"'+e.series+'", "vehicle_type":"'+e.vehicle_type+'", "color":"'+e.color+'", "year":"'+e.vehicle_year+'"}}, "ticket_type_id":"'+e.ticket_type_id+'", "parking_meter_id":"'+e.parking_meter_id+'", "detained_plates":"'+e.detained_plates+'", "observations":"'+e.observations+'"}, "commit":"Crear Multa"}',o=Titanium.Network.createHTTPClient(),r=Ti.App.hostname+"/mobile_services/create_ticket.json";Ti.API.info("createTicket url --------------------- "+r),Ti.API.info("createTicket data --------------------- "+i),o.open("POST",r),o.setRequestHeader("Content-Type","application/json"),o.send(i),o.setTimeout(7e3),o.onerror=function(e){Ti.API.info("Error createTicket ------------ "+JSON.stringify(e)),showMessageError(L("error")+" "+L("try_again")),t(!1)},o.onload=function(){var e;try{if(e=JSON.parse(this.responseText),Ti.API.info("createTicket response ------------------- "+JSON.stringify(e)),void 0!=e.error)showMessageError(e.error),t(!1);else if(void 0==e.ticket){var i="";for(var o in e)i+=e[o]+"\n";showMessage(i),t(!1)}else t(e)}catch(r){Ti.API.info("createTicket ex "+r.toString()),t(!1)}}}else t(!1)},exports.makePayment=function(e,t){if(checkInternetConnection()){var i='{"utf8":"✓", "payment":{  "ticket_id":"'+e.ticket_id+'", "payment_type_id":"'+e.payment_type_id+'", "bill_id":"", "bill_attributes":{  "rfc":"'+e.rfc+'", "name":"'+e.name+'", "email":"'+e.email+'", "phone":"'+e.phone+'", "address1":"'+e.address1+'", "address2":"'+e.address2+'", "city":"'+e.city+'", "state":"'+e.state+'", "zip":"'+e.zip+'"}}, "commit":"Crear Pago"}',o=Titanium.Network.createHTTPClient(),r=Ti.App.hostname+"/mobile_services/create_payment.json";Ti.API.info("makePayment url --------------------- "+r),Ti.API.info("makePayment data --------------------- "+i),o.open("POST",r),o.setRequestHeader("Content-Type","application/json"),o.send(i),o.setTimeout(7e3),o.onerror=function(e){Ti.API.info("Error makePayment ------------ "+JSON.stringify(e)),showMessageError(L("error")+" "+L("try_again")),t(!1)},o.onload=function(){var e;try{if(e=JSON.parse(this.responseText),Ti.API.info("makePayment response ------------------- "+JSON.stringify(e)),void 0!=e.error)showMessageError(e.error),t(!1);else if(void 0==e.payment.ticket_id){var i="";for(var o in e)i+=e[o]+"\n";showMessage(JSON.stringify(i)),t(!1)}else t(e)}catch(r){Ti.API.info("makePayment ex "+r.toString()),t(!1)}}}else t(!1)},exports.createTrack=function(e){var t='{"utf8":"✓", "track":{"latitude" : "'+Ti.App.Properties.getString("latitude")+'", "longitude" : "'+Ti.App.Properties.getString("longitude")+'"}, "commit":"Crear Localizador"}',i=Titanium.Network.createHTTPClient(),o=Ti.App.hostname+"/mobile_services/create_track.json";Ti.API.info("createTrack url --------------------- "+o),Ti.API.info("createTrack data --------------------- "+t),i.open("POST",o),i.setRequestHeader("Content-Type","application/json"),i.send(t),i.setTimeout(7e3),i.onerror=function(t){Ti.API.info("Error createTrack ------------ "+JSON.stringify(t)),e(!0)},i.onload=function(){e(!0)}},Titanium.Geolocation.getCurrentPosition(reportPosition),Titanium.Geolocation.addEventListener("location",reportPosition);