Ti.App.hostname="http://108.174.146.68",require("lib/style").loadStyles(),Titanium.include("/lib/global.js");var network=require("/lib/network"),database=require("/lib/database");database.selectUserName({person:!1},function(i){function e(){Ti.API.info("Ti.Platform.name "+Ti.Platform.name);var i=Ti.Platform.displayCaps.platformWidth,e=Ti.Platform.displayCaps.platformHeight;i>e&&"ipad"!=Ti.Platform.name?(imageViewLogo.height="0dp",imageViewLogo.width="0dp",imageViewLogo.top="5dp"):(imageViewLogo.height="120dp",imageViewLogo.width="120dp",imageViewLogo.top="5dp")}function o(i){i?(indicatorLogin.show(),textFieldLogin.visible=!1,textFieldPassword.visible=!1,textFieldPassword.visible=!1,viewShowPassword.visible=!1,buttonLogin.height=0):(indicatorLogin.hide(),textFieldLogin.visible=!0,textFieldPassword.visible=!0,viewShowPassword.visible=!0,buttonLogin.height="45dp")}LoginWindow=Ti.UI.createWindow({exitOnClose:!0,backgroundColor:Ti.App.backgroundColor,layout:"vertical"}),viewBarLogin=Titanium.UI.createView({backgroundColor:Ti.App.appColor,width:"100%",layout:"horizontal",height:"60dp"}),imageViewLogo=Titanium.UI.createImageView({image:"/images/logo.png"}),labelVersion=Ti.UI.createLabel({text:L("version")+" "+Titanium.App.version,top:1,right:"5dp",verticalAlign:"right",font:{fontSize:Ti.App.fontSizeSmall},color:Ti.App.labelColor}),textFieldLogin=Ti.UI.createTextField({value:i,hintText:L("username"),width:"90%",top:0,textAlign:"center",paddingLeft:10,borderRadius:2}),textFieldPassword=Ti.UI.createTextField({value:"Password1",hintText:L("password"),width:"90%",top:"1dp",textAlign:"center",borderRadius:2,paddingLeft:10,passwordMask:!0}),viewShowPassword=Ti.UI.createView({height:Ti.UI.SIZE,width:Ti.UI.SIZE,layout:"horizontal"}),labelShowPasssword=Ti.UI.createLabel({text:L("show_password"),font:{fontSize:Ti.App.fontSizeSmall},color:Ti.App.labelColor}),switchShowPassword=Titanium.UI.createSwitch({touchEnabled:!1}),"android"==Ti.Platform.name&&(switchShowPassword.style=Titanium.UI.Android.SWITCH_STYLE_CHECKBOX),buttonLogin=Ti.UI.createButton({title:L("login"),width:"90%",height:"45dp",top:"10dp",borderRadius:4,backgroundColor:Ti.App.appColor,color:Ti.App.buttonTextColor}),indicatorLogin=Ti.UI.createActivityIndicator({top:0,style:"android"==Ti.Platform.name?Ti.UI.ActivityIndicatorStyle.BIG:Ti.UI.ActivityIndicatorStyle.BIG,center:{x:"50%"}}),labelRights=Ti.UI.createLabel({text:L("rights_value"),width:"90%",textAlign:"center",font:{fontSize:Ti.App.fontSizeSmall},color:Ti.App.labelColor,bottom:"15dp"}),viewTopLogin=Ti.UI.createView({color:"transparent",width:"100%",height:"88%",layout:"vertical"}),viewBottomLogin=Ti.UI.createView({color:"transparent",width:"100%",height:"12%"}),viewShowPassword.add(switchShowPassword),viewShowPassword.add(labelShowPasssword),viewTopLogin.add(viewBarLogin),viewTopLogin.add(labelVersion),viewTopLogin.add(imageViewLogo),viewTopLogin.add(textFieldLogin),viewTopLogin.add(textFieldPassword),viewTopLogin.add(viewShowPassword),viewTopLogin.add(buttonLogin),viewTopLogin.add(indicatorLogin),LoginWindow.add(viewTopLogin),LoginWindow.add(viewBottomLogin),e(),viewShowPassword.addEventListener("click",function(i){1==switchShowPassword.value?(switchShowPassword.value=!1,textFieldPassword.passwordMask=!0):(switchShowPassword.value=!0,textFieldPassword.passwordMask=!1)}),buttonLogin.addEventListener("click",function(i){var e=new Date;e-i.source.clickTime<2e3||(i.source.clickTime=e,0==textFieldLogin.value.trim().length||0==textFieldPassword.value.trim().length?showMessage(L("valid_user")):(o(!0),network.login({username:textFieldLogin.value,password:textFieldPassword.value},function(i){0!=i?network.getData(function(i){0!=i?database.setUser({user_id:i.user.id,first_name:i.user.first_name,last_name:i.user.last_name,role_id:i.user.role_id,username:i.user.username,email:i.user.email},function(e){0!=e?(Ti.App.Properties.setObject("userdata",i),AplicationWindow=require("ui/ApplicationWindow"),(new AplicationWindow).open(),LoginWindow.close(),setTimeout(function(){o(!1)},1500)):o(!1)}):o(!1)}):o(!1)})))}),buttonLogin.addEventListener("touchstart",function(i){i.source.backgroundColor=Ti.App.selectedColor}),buttonLogin.addEventListener("touchend",function(i){i.source.backgroundColor=Ti.App.appColor}),buttonLogin.addEventListener("touchcancel",function(i){i.source.backgroundColor=Ti.App.appColor}),Ti.Gesture.addEventListener("orientationchange",function(i){e()}),"ipad"==Ti.Platform.osname&&(textFieldLogin.top="20dp",textFieldPassword.top="20dp",viewShowPassword.top="20dp",buttonLogin.top="50dp"),LoginWindow.open()});